<?xml version="1.0" encoding="ISO-8859-1"?>
<Invoice xmlns="urn:oasis:names:specification:ubl:schema:xsd:Invoice-2" xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2" xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2" xmlns:ccts="urn:un:unece:uncefact:documentation:2" xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:ext="urn:oasis:names:specification:ubl:schema:xsd:CommonExtensionComponents-2" xmlns:qdt="urn:oasis:names:specification:ubl:schema:xsd:QualifiedDatatypes-2" xmlns:udt="urn:un:unece:uncefact:data:specification:UnqualifiedDataTypesSchemaModule:2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    {#firma digital#}
    <ext:UBLExtensions>
        <ext:UBLExtension>
            <ext:ExtensionContent>
                <ds:Signature Id="SignSUNAT" xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
                    <ds:SignedInfo><ds:CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"/>
                        <ds:SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/>
                        <ds:Reference URI="">
                            <ds:Transforms>
                                <ds:Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
                            </ds:Transforms><ds:DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/>
                            <ds:DigestValue>5iNn52k/8djIT+7jMGOUaytOT+c=</ds:DigestValue>
                        </ds:Reference>
                    </ds:SignedInfo>
                    <ds:SignatureValue>T70U2dt22BHxmIuM0aYVADnO0p1Gw7GMLp3U6DK7eLaXR2XBfqA2wDZNxuguXKNksDeMWwCOBzDb
                        Mb4TM8GxjsIwBZGM75HgH3Lve9wZ/x+s88TsOwmuyDfMcgAwOxnA4mQ9hBixT8Dfq0E5XBjwEo1N
                        +0/BX1H/gyAij4WgHfD5B3tduUYwkt1GHP7kKmiO4s9NstAP0lT9Jc8ZCV4ewUfEjXP0wjR/GfR8
                        0pLitvfv3FyKaVe31BWu0WyqAhDvcMHA2TW+oSfY4xrF7G1LupWL6p4PgVStcL3qNPPMHvf28Pkh
                        vG6/hKpFLurfbw/zIe8WABM2ADpmqaAfRUlq1w==
                    </ds:SignatureValue>
                    <ds:KeyInfo>
                        <ds:X509Data>
                            <ds:X509Certificate>MIIE8jCCA9qgAwIBAgIDAP+ZMA0GCSqGSIb3DQEBBQUAMIIBDTEbMBkGCgmSJomT8ixkARkWC0xM
                                QU1BLlBFIFNBMQswCQYDVQQGEwJQRTENMAsGA1UECAwETElNQTENMAsGA1UEBwwETElNQTEYMBYG
                                A1UECgwPVFUgRU1QUkVTQSBTLkEuMUUwQwYDVQQLDDxETkkgOTk5OTk5OSBSVUMgMTAwOTcxNzI1
                                NjYgLSBDRVJUSUZJQ0FETyBQQVJBIERFTU9TVFJBQ0nDk04xRDBCBgNVBAMMO05PTUJSRSBSRVBS
                                RVNFTlRBTlRFIExFR0FMIC0gQ0VSVElGSUNBRE8gUEFSQSBERU1PU1RSQUNJw5NOMRwwGgYJKoZI
                                hvcNAQkBFg1kZW1vQGxsYW1hLnBlMB4XDTE4MDkxNjAyMTczNVoXDTIwMDkxNTAyMTczNVowggEN
                                MRswGQYKCZImiZPyLGQBGRYLTExBTUEuUEUgU0ExCzAJBgNVBAYTAlBFMQ0wCwYDVQQIDARMSU1B
                                MQ0wCwYDVQQHDARMSU1BMRgwFgYDVQQKDA9UVSBFTVBSRVNBIFMuQS4xRTBDBgNVBAsMPEROSSA5
                                OTk5OTk5IFJVQyAxMDA5NzE3MjU2NiAtIENFUlRJRklDQURPIFBBUkEgREVNT1NUUkFDScOTTjFE
                                MEIGA1UEAww7Tk9NQlJFIFJFUFJFU0VOVEFOVEUgTEVHQUwgLSBDRVJUSUZJQ0FETyBQQVJBIERF
                                TU9TVFJBQ0nDk04xHDAaBgkqhkiG9w0BCQEWDWRlbW9AbGxhbWEucGUwggEiMA0GCSqGSIb3DQEB
                                AQUAA4IBDwAwggEKAoIBAQC8P6OOgxY/CuqkvFBNXLufCJZB+4z60Mz+VZE/kEkq5ZH/Ll53cj+p
                                BUEqye3kRIn9Capp0iuoHtMbf1+NcwebMsxqE2mUCzQjyn7WuRr/cfly0+VfNje/vdrD9quxpu2X
                                6p/4DKqAR4wbWUZqAIfSEJBykk8dIEonkLZLc9s5m63VRMTohsz4w9LAr8S1w0iN818XSYaUgyWH
                                65uJSetnNqJ4j4cFx7S90Qf8So8Ek/gvyCC5WUdSAZ+3XWShn7cQCWUUXW3sF+Pqv9xi1/b739Lt
                                shYZ2uqRpquCFvYgj80tzyhp5UmnzpXX8wFMXtLg7KUkbx2J45U7jPuigeB1AgMBAAGjVzBVMB0G
                                A1UdDgQWBBTn/ZHnhNXYJlTX3pqFe9LTSzIuUjAfBgNVHSMEGDAWgBTn/ZHnhNXYJlTX3pqFe9LT
                                SzIuUjATBgNVHSUEDDAKBggrBgEFBQcDATANBgkqhkiG9w0BAQUFAAOCAQEALCeZoyqgNYO/cKzp
                                n0YBApowD/GUf1Ykxs3ie8Y7yTOQjrm3HPrKyrpP9uRC4fZes/8BLbDtJFNHlNVIi1GK9X03Kpha
                                U9eZ3lHmJ1M46eWqwNE9vV3v/JjNzoX3XF3U8LE/YIv2HYsvDxAk2GKE9jgAWZ5ldClUF3Gp/11+
                                Vvd94qYx0unzy5u6MLyY9RxqTzWF+K8rZpbjQngDxMukQ3lkUhGafnPPmLYUkfHLeXvkYR3ul+TN
                                wOxdunP/58DSYiWEGEs44g==
                            </ds:X509Certificate>
                        </ds:X509Data>
                    </ds:KeyInfo>
                </ds:Signature>
            </ext:ExtensionContent>
        </ext:UBLExtension>
    </ext:UBLExtensions>
    {#Versión del UBL#}
    <cbc:UBLVersionID>2.1</cbc:UBLVersionID>
    {#Versión de la estructura del documento#}
    <cbc:CustomizationID>2.0</cbc:CustomizationID>
    {#Código de tipo de operación#}
    <cbc:ID>FA01-00000156</cbc:ID>
    {# Fecha de emisión#}
    <cbc:IssueDate>{{ venta.fecha|date('Y-m-d') }}</cbc:IssueDate>
    {#Hora de emisión #}
    <cbc:IssueTime>{{ venta.fecha|date('h:i:s') }}</cbc:IssueTime>

    {#Tipo de documento (Factura)#}
    <cbc:InvoiceTypeCode
            listAgencyName="PE:SUNAT"
            listName="Tipo de Documento"
            listURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo01">01
    </cbc:InvoiceTypeCode>
    {#Leyendas#}
    <cbc:Note languageLocaleID="1000"><![CDATA[{{ apagar|upper }} ]]></cbc:Note>
    {# Tipo de moneda en la cual se emite la factura electrónica#}
    <cbc:DocumentCurrencyCode
            listAgencyName="United Nations Economic Commission for Europe"
            listID="ISO 4217 Alpha"
            listName="Currency">PEN
    </cbc:DocumentCurrencyCode>
    <!-- Guia -->
    {#Tipo y número de la guía de remisión relacionada con la operación que se factura#}
    <cac:DespatchDocumentReference>
        <cbc:ID>00{{venta.serie}}-{{venta.numerodedocumento }}</cbc:ID>
        <cbc:DocumentTypeCode
                listAgencyName="PE:SUNAT"
                listName="Tipo de Documento"
                listURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo01">09
        </cbc:DocumentTypeCode>
    </cac:DespatchDocumentReference>
    <cac:Signature>
        <cbc:ID>10097172566</cbc:ID>
        <cbc:Note>Elaborado por Sistema de Emision Electronica Facturador SUNAT (SEE-SFS) 1.2</cbc:Note>
        <cac:SignatoryParty>
            <cac:PartyIdentification>
                <cbc:ID>10097172566</cbc:ID>
            </cac:PartyIdentification>
            <cac:PartyName>
                <cbc:Name><![CDATA[Bertha]]></cbc:Name>
            </cac:PartyName>
        </cac:SignatoryParty>
        <cac:DigitalSignatureAttachment>
            <cac:ExternalReference>
                <cbc:URI>SIGN</cbc:URI>
            </cac:ExternalReference>
        </cac:DigitalSignatureAttachment>
    </cac:Signature>
    {#Nombre Comercial del emisor
    Apellidos y nombres, denominación o razón social del emisor
    Tipo y Número de RUC del emisor
    Código del domicilio fiscal o de local anexo del emisor#}
    <cac:AccountingSupplierParty>
        <cac:Party>
            <cac:PartyIdentification>
                <cbc:ID schemeAgencyName="PE:SUNAT"
                        schemeID="6"
                        schemeName="Documento de Identidad"
                        schemeURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo06">10097172566</cbc:ID>
            </cac:PartyIdentification>
            <cac:PartyName>
                <cbc:Name><![CDATA[Bertha]]></cbc:Name>
            </cac:PartyName>
            <cac:PartyLegalEntity>
                <cbc:RegistrationName><![CDATA[Montero placas]]></cbc:RegistrationName>
                <cac:RegistrationAddress>
                    <cbc:AddressTypeCode>0000</cbc:AddressTypeCode>
                    <cbc:CitySubdivisionName><![CDATA[LIMA]]></cbc:CitySubdivisionName>
                    <cbc:CityName><![CDATA[LIMA]]></cbc:CityName>
                    <cbc:CountrySubentity><![CDATA[LIMA]]></cbc:CountrySubentity>
                    <cbc:CountrySubentityCode><![CDATA[HABIDO]]></cbc:CountrySubentityCode>
                    <cbc:District><![CDATA[Distrito Villa María del triunfo]]></cbc:District>
                    <cac:AddressLine>
                        <cbc:Line><![CDATA[LIMA]]></cbc:Line>
                    </cac:AddressLine>
                    <cac:Country>
                        <cbc:IdentificationCode>PE</cbc:IdentificationCode>
                    </cac:Country>
                </cac:RegistrationAddress>
            </cac:PartyLegalEntity>
        </cac:Party>
    </cac:AccountingSupplierParty>

   {# Tipo y número de documento de identidad del adquirente o usuario
    Apellidos y nombres, denominación o razón social del adquirente o usuario#}
    <cac:AccountingCustomerParty>
        <cac:Party>
            <cac:PartyIdentification>
                <cbc:ID schemeAgencyName="PE:SUNAT"
                        schemeID="6"
                        schemeName="Documento de Identidad"
                        schemeURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo06">{{ venta.cliente.ruc }}</cbc:ID>
            </cac:PartyIdentification>
            <cac:PartyLegalEntity>
                <cbc:RegistrationName><![CDATA[{{ venta.cliente.nombre|upper }}]]></cbc:RegistrationName>
            </cac:PartyLegalEntity>
        </cac:Party>
    </cac:AccountingCustomerParty>

    {% if venta.documento.igv %}
        {% set igv= (venta.montototalapagar/1.18*0.18)|number_format(2, '.', ',')   %}
        {% set total= venta.montototalapagar %}
        {% set subtotal= venta.montototalapagar/1.18  %}
    {% else %}
        {% set igv= 0 %}
        {% set total= venta.montototalapagar + igv  %}
    {% endif %}
    <!-- Inicio Tributos cabecera-->
    {#
    Monto total de impuestos
    Monto las operaciones gravadas
    Monto las operaciones Exoneradas
    Monto las operaciones inafectas del impuesto (Ver Ejemplo en la página 47)
    Monto las operaciones gratuitas (Ver Ejemplo en la página 48)
    Sumatoria de IGV
    Sumatoria de ISC (Ver Ejemplo en la página 51)
    Sumatoria de Otros Tributos (Ver Ejemplo en la página 52)#}
    <cac:TaxTotal>
        <cbc:TaxAmount currencyID="PEN">{{ igv }}</cbc:TaxAmount>
        <cac:TaxSubtotal>
            <cbc:TaxableAmount currencyID="PEN">{{ total }}</cbc:TaxableAmount>
            <cbc:TaxAmount currencyID="PEN">{{ igv }}</cbc:TaxAmount>
            <cac:TaxCategory>
                <cac:TaxScheme>
                    <cbc:ID
                            schemeAgencyName="PE:SUNAT"
                            schemeID="UN/ECE 5153"
                            schemeName="Codigo de tributos">1000
                    </cbc:ID>
                    <cbc:Name>IGV</cbc:Name>
                    <cbc:TaxTypeCode>VAT</cbc:TaxTypeCode>
                </cac:TaxScheme>
            </cac:TaxCategory>
        </cac:TaxSubtotal>
        <cac:TaxSubtotal>
            <cbc:TaxableAmount currencyID="PEN">100.00</cbc:TaxableAmount>
            <cbc:TaxAmount currencyID="PEN">2.00</cbc:TaxAmount>
            <cac:TaxCategory>
                <cac:TaxScheme>
                    <cbc:ID
                            schemeAgencyName="PE:SUNAT"
                            schemeID="UN/ECE 5153"
                            schemeName="Codigo de tributos">2000</cbc:ID>
                    <cbc:Name>ISC</cbc:Name>
                    <cbc:TaxTypeCode>EXC</cbc:TaxTypeCode>
                </cac:TaxScheme>
            </cac:TaxCategory>
        </cac:TaxSubtotal>
    </cac:TaxTotal>
    <!-- Fin Tributos  Cabecera-->
    {#
    Total valor de venta
    Total precio de venta (incluye impuestos)
    Monto total de descuentos del comprobante
    Monto total de otros cargos del comprobante
    Importe total de la venta, cesión en uso o del servicio prestado#}
    <cac:LegalMonetaryTotal>
        <cbc:LineExtensionAmount currencyID="PEN">{{ subtotal }}</cbc:LineExtensionAmount>
        <cbc:TaxInclusiveAmount currencyID="PEN">{{ venta.montototalapagar }}</cbc:TaxInclusiveAmount>
        <cbc:AllowanceTotalAmount currencyID="PEN">0.00</cbc:AllowanceTotalAmount>
        <cbc:ChargeTotalAmount currencyID="PEN">0.00</cbc:ChargeTotalAmount>
        <cbc:PrepaidAmount currencyID="PEN">0.00</cbc:PrepaidAmount>
        <cbc:PayableAmount currencyID="PEN">{{ venta.montototalapagar }}</cbc:PayableAmount>
    </cac:LegalMonetaryTotal>
    {#Número de orden del Ítem
    Cantidad y Unidad de medida por ítem
    Valor de venta del ítem#}
    {% for art in venta.articuloventas %}
    <cac:InvoiceLine>
        <cbc:ID>{{ loop.index }}</cbc:ID>
        <cbc:InvoicedQuantity
                unitCode="NIU"
                unitCodeListAgencyName="United Nations Economic Commission for Europe"
                unitCodeListID="UN/ECE rec 20">{{ art.cantidad }}
        </cbc:InvoicedQuantity>
        <cbc:LineExtensionAmount currencyID="PEN">{{ art.importe }}</cbc:LineExtensionAmount>
        <cac:PricingReference>
            <cac:AlternativeConditionPrice>
                <cbc:PriceAmount currencyID="PEN">{{ art.precio }}</cbc:PriceAmount>
                <cbc:PriceTypeCode
                        listAgencyName="PE:SUNAT"
                        listName="Tipo de Precio"
                        listURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo16">01
                </cbc:PriceTypeCode>
            </cac:AlternativeConditionPrice>
        </cac:PricingReference>
        <!-- Inicio Tributos -->
        <cac:TaxTotal>
            <cbc:TaxAmount currencyID="PEN">18.00</cbc:TaxAmount>
            <cac:TaxSubtotal>
                <cbc:TaxableAmount currencyID="PEN">100.00</cbc:TaxableAmount>
                <cbc:TaxAmount currencyID="PEN">18.00</cbc:TaxAmount>
                <cac:TaxCategory>
                    <cbc:Percent>18.00</cbc:Percent>
                    <cbc:TaxExemptionReasonCode
                            listAgencyName="PE:SUNAT"
                            listName="Afectacion del IGV"
                            listURI="urn:pe:gob:sunat:cpe:see:gem:catalogos:catalogo07">10</cbc:TaxExemptionReasonCode>
                    <cac:TaxScheme>
                        <cbc:ID
                                schemeAgencyName="PE:SUNAT"
                                schemeID="UN/ECE 5153"
                                schemeName="Codigo de tributos">1000</cbc:ID>
                        <cbc:Name>IGV</cbc:Name>
                        <cbc:TaxTypeCode>VAT</cbc:TaxTypeCode>
                    </cac:TaxScheme>
                </cac:TaxCategory>
            </cac:TaxSubtotal>

        </cac:TaxTotal>
        <!-- Fin Tributos -->
        <cac:Item>
            <cbc:Description><![CDATA[{{ art.articulo.nombre }}]]></cbc:Description>
            <cac:SellersItemIdentification>
                <cbc:ID>{{ art.codigo }}</cbc:ID>
            </cac:SellersItemIdentification>
        </cac:Item>
        <cac:Price>
            <cbc:PriceAmount currencyID="PEN">{{ art.precio * 1.18 }}</cbc:PriceAmount>
        </cac:Price>
    </cac:InvoiceLine>
    {% endfor %}
</Invoice>